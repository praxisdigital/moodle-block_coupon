define("block_coupon/preview",["exports","jquery","core/str","core/notification"],(function(_exports,_jquery,Str,Notification){var obj;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj},Str=_interopRequireWildcard(Str),Notification=_interopRequireWildcard(Notification);const encodeQueryParams=function(data){const ret=[];for(let d in data)ret.push(encodeURIComponent(d)+"="+encodeURIComponent(data[d]));return ret.join("&")};class CouponPreview{constructor(selector,url){_defineProperty(this,"title",null),_defineProperty(this,"url",null),_defineProperty(this,"modal",null),_defineProperty(this,"selector",null),this.selector=selector,this.url=url,Str.get_string("preview-pdf","block_coupon").then(function(title){this.title=title,this.setupHandlers()}.bind(this)).fail(Notification.exception)}closeHandler(){this.destroy()}clickOutHandler(e){(0,_jquery.default)(e.target)==this.modal&&this.destroy()}setupHandler(e){var url=this.url,extraparams={},el=e.currentTarget;el.dataset.templated?extraparams.templateid=el.dataset.templateid:(extraparams.font=el.dataset.font,extraparams.logoid=el.dataset.logo,extraparams.qr=el.dataset.qr),Object.keys(extraparams).length&&(url.indexOf("?")>=0?url+="&"+encodeQueryParams(extraparams):url+="?"+encodeQueryParams(extraparams));var html='<div id="block-coupon-modal"><div class="block-coupon-modal-content">';html+='<div class="block-coupon-modal-header">',html+='<span id="block-modal-close" class="close">&times;</span>',html+="<h2>"+this.title+"</h2>",html+="</div>",html+='<div class="block-coupon-modal-body">',html+='<iframe src="'+url+'"></iframe>',html+="</div>",html+="</div></div>",this.modal=(0,_jquery.default)(html),(0,_jquery.default)("body").append(this.modal),this.modal.hide(),(0,_jquery.default)("#block-modal-close").on("click",this.destroy.bind(this)),(0,_jquery.default)("body").on("click",this.clickOutHandler.bind(this)),this.modal.show()}setupHandlers(){(0,_jquery.default)(this.selector).on("click",this.setupHandler.bind(this))}destroy(){(0,_jquery.default)("#block-modal-close").off("click"),(0,_jquery.default)("body").off("click"),this.modal.hide(),this.modal.remove()}}var _default={init:function(clickselector,url){new CouponPreview(clickselector,url)}};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=preview.min.js.map